---
title: "Customer Deposits"
description: "Learn how to generate checkout links for customer deposits"
icon: "piggy-bank"
---

Generate checkout links that allow customers to deposit funds directly into your AI Agent's wallet. When customers complete the payment process, the funds will be immediately available for your agent to use.

## Creating a Deposit Link

Generate a checkout URL where customers can complete their deposit:

```typescript
const depositLink = await payman.payments.initiateDeposit({
	amountDecimal: 100.0,
	memo: "Wallet deposit",
	metadata: {
		customerId: "cust_123",
		customerEmail: "customer@example.com",
	},
});

// Redirect customer to the checkout URL
console.log("Checkout URL:", depositLink.checkoutUrl);
```

## Parameters

### Required Parameters

| Parameter       | Type   | Description                                   |
| --------------- | ------ | --------------------------------------------- |
| `amountDecimal` | number | The deposit amount (e.g., 100.00 for $100.00) |

### Optional Parameters

| Parameter  | Type   | Description                                              |
| ---------- | ------ | -------------------------------------------------------- |
| `walletId` | string | Target wallet ID (if agent has multiple wallets)         |
| `memo`     | string | Note for the transaction (visible to customers)          |
| `feeMode`  | string | How to handle processing fees (see Fee Handling section) |
| `metadata` | object | Additional key-value data for tracking purposes          |

## Fee Handling Options

Control how payment processing fees are handled using the `feeMode` parameter:

```typescript
// Fees are deducted from the deposit amount (default)
const includedFees = await payman.payments.initiateDeposit({
	amountDecimal: 100.0,
	feeMode: "INCLUDED_IN_AMOUNT", // Customer pays exactly $100.00, agent receives less
});

// Fees are added on top of the deposit amount
const addedFees = await payman.payments.initiateDeposit({
	amountDecimal: 100.0,
	feeMode: "ADD_TO_AMOUNT", // Customer pays more than $100.00, agent receives full $100.00
});
```

## Response Object

The API returns an object containing the checkout URL:

```typescript
{
  checkoutUrl: string,  // URL where customer completes the deposit
  expiresAt: string,    // ISO timestamp when the link expires
  id: string            // Unique ID for this deposit link
}
```

## Using Metadata for Customer Information

Since customer details are no longer required parameters, you can include them in the metadata object:

```typescript
const depositLink = await payman.payments.initiateDeposit({
	amountDecimal: 50.0,
	memo: "Premium subscription",
	metadata: {
		customerId: "cust_456",
		customerEmail: "customer@example.com",
		customerName: "Jane Smith",
		orderId: "order_789",
		subscriptionTier: "premium",
		source: "web_checkout",
	},
});
```

## Error Handling

Implement proper error handling to manage API exceptions:

```typescript
try {
	const depositLink = await payman.payments.initiateDeposit({
		amountDecimal: 100.0,
		memo: "Account funding",
	});

	// Success - redirect customer to the checkout URL
	redirectToCheckout(depositLink.checkoutUrl);
} catch (error) {
	if (error.code === "invalid_amount") {
		console.error("Invalid deposit amount specified");
	} else if (error.code === "wallet_not_found") {
		console.error("Specified wallet not found");
	} else if (error.code === "insufficient_permissions") {
		console.error("Agent lacks permission to create deposit links");
	} else {
		console.error("Failed to create deposit link:", error.message);
	}
}
```

<Note>
	**Important:** The generated checkout URL is valid for 24 hours. After
	expiration, you'll need to create a new deposit link. Each link can only be
	used once, regardless of whether a payment was completed.
</Note>

